file://<WORKSPACE>/src/main/scala/systolic/systolic.scala
### java.lang.StringIndexOutOfBoundsException: String index out of range: -6

occurred in the presentation compiler.

presentation compiler configuration:
Scala version: 2.12.15
Classpath:
<WORKSPACE>/.bloop/easymac/bloop-bsp-clients-classes/classes-Metals-KuLquRkPSvG_FXFXrbGSRg== [exists ], <HOME>/.cache/bloop/semanticdb/com.sourcegraph.semanticdb-javac.0.9.9/semanticdb-javac-0.9.9.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/scala-library/2.12.15/scala-library-2.12.15.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/chisel-iotesters_2.12/1.4.1/chisel-iotesters_2.12-1.4.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/chisel3_2.12/3.3.1/chisel3_2.12-3.3.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/firrtl_2.12/1.3.1/firrtl_2.12-1.3.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/firrtl-interpreter_2.12/1.3.1/firrtl-interpreter_2.12-1.3.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/treadle_2.12/1.2.1/treadle_2.12-1.2.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/junit/junit/4.13/junit-4.13.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scalatest/scalatest_2.12/3.0.8/scalatest_2.12-3.0.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scalacheck/scalacheck_2.12/1.14.3/scalacheck_2.12-1.14.3.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/com/github/scopt/scopt_2.12/3.7.1/scopt_2.12-3.7.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/chisel3-macros_2.12/3.3.1/chisel3-macros_2.12-3.3.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/edu/berkeley/cs/chisel3-core_2.12/3.3.1/chisel3-core_2.12-3.3.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/scala-reflect/2.12.15/scala-reflect-2.12.15.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/antlr/antlr4-runtime/4.7.1/antlr4-runtime-4.7.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/com/google/protobuf/protobuf-java/3.9.0/protobuf-java-3.9.0.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/net/jcazevedo/moultingyaml_2.12/0.4.2/moultingyaml_2.12-0.4.2.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/json4s/json4s-native_2.12/3.6.8/json4s-native_2.12-3.6.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/apache/commons/commons-text/1.8/commons-text-1.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/modules/scala-jline/2.12.1/scala-jline-2.12.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scalactic/scalactic_2.12/3.0.8/scalactic_2.12-3.0.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/modules/scala-xml_2.12/1.2.0/scala-xml_2.12-1.2.0.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-sbt/test-interface/1.0/test-interface-1.0.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/com/github/nscala-time/nscala-time_2.12/2.22.0/nscala-time_2.12-2.22.0.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/yaml/snakeyaml/1.26/snakeyaml-1.26.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/json4s/json4s-core_2.12/3.6.8/json4s-core_2.12-3.6.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/apache/commons/commons-lang3/3.9/commons-lang3-3.9.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/fusesource/jansi/jansi/1.11/jansi-1.11.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/joda-time/joda-time/2.10.1/joda-time-2.10.1.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/joda/joda-convert/2.2.0/joda-convert-2.2.0.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/json4s/json4s-ast_2.12/3.6.8/json4s-ast_2.12-3.6.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/org/json4s/json4s-scalap_2.12/3.6.8/json4s-scalap_2.12-3.6.8.jar [exists ], <HOME>/.cache/coursier/v1/https/repo1.maven.org/maven2/com/thoughtworks/paranamer/paranamer/2.8/paranamer-2.8.jar [exists ]
Options:
-deprecation -feature -unchecked -language:reflectiveCalls -Xsource:2.11 -Yrangepos -Xplugin-require:semanticdb


action parameters:
offset: 1955
uri: file://<WORKSPACE>/src/main/scala/systolic/systolic.scala
text:
```scala
package systolic

import io._
import ppadder._
import partialprod._
import wallace._
import wtmultiplier._
import mac.MAC

import chisel3.iotesters.PeekPokeTester
import chisel3.util._
import chisel3.{Bundle, Input, Module, Output, UInt, _}

import java.io.PrintWriter
import java.io.File

import scala.io.Source
class systolicPE extends Module {
  val io=IO(new Bundle{
    val a=1
  })
}

object test {
  val usage =
    """
      Usage: generate [--compressor-file filename1] [--prefix-adder-file filename2] [--accumulator-file filename3] [--systolic-file filename4]
  """

  def main(args: Array[String]): Unit = {

    if (args.length == 0) println(usage)

    val arglist = args.toList

    //type OptionMap = Map[Symbol, Any]

    val argmap = (0 until arglist.size / 2).map(i => arglist(i * 2) -> arglist(i * 2 + 1)).toMap

    val filename1 = argmap("--compressor-file")
    val filename2 = argmap("--prefix-adder-file")
    val filename3 = argmap("--accumulator-file")
    val filename4 = argmap("--systolic-file")
    
    (new chisel3.stage.ChiselStage).emitVerilog(topDesign(), Array("-td", "./RTL/mac"))
    iotesters.Driver.execute(Array("-tgvo", "on", "-tbn", "verilator"), topDesign) {
      c => new SystolicTester(c)
    }
  }
}
//a
class SystolicTester(c: MAC) extends PeekPokeTester(c) {
  poke(c.io.multiplicand, 7)
  poke(c.io.multiplier, 2)
  poke(c.io.addend, 1)

  step(1)

  println("The result of 7 * 2 + 1 is: " + peek(c.io.outs).toString())

  expect(c.io.outs, 15)
}


class PE(
  m:Int,n:Int, myarchw: List[Int], inedges: Map[List[Int], List[Int]], outedges: Map[List[Int], List[Int]], res: Map[Int, List[Int]],
          myarcha: List[Int], pedge: Map[List[Int], List[Int]], gedge: Map[List[Int], List[Int]], post: Map[Int, Int],
          myarcha2: List[Int], pedge2: Map[List[Int], List[Int]], gedge2: Map[List[Int], List[Int]], post2: Map[Int, Int],// from MAC
  pesize:Int
) extends Module{
  val a_in = IO(Input((Vec,@@UInt(m.W)))
  val a_out = IO(Output(UInt(m.W)))
  val b_in = IO(Input(UInt(n.W)))
  val b_out = IO(Output(UInt(n.W)))
  val c_in = IO(Input(UInt((m + n - 1).W)))
  val c_out = IO(Output(UInt((m + n - 1).W)))
  val stationaryCtrl = IO(Input(Bool()))
  def systolicInput(din:UInt, dout:UInt):UInt ={
    val r = RegNext(din)
    dout := r
    r // return
  }

  def stationaryOutput(din:UInt, dout:UInt): Unit = {
    val r = Reg(UInt)
    when (stationaryCtrl) { r := din }
    .otherwise { r := compute_result }
    dout := r
  }// may error?

  val data_A :UInt=  systolicInput(a_in, a_out)
  val data_B :UInt=  systolicInput(b_in, b_out)

  val mac=Module(new MAC(m, n, myarchw, inedges, outedges, res, myarcha, pedge, gedge, post, myarcha2, pedge2, gedge2, post2))
    
  val compute_result = mac.io.outs
  mac.io.addend:=c_out
  mac.io.multiplicand:=a_in
  mac.io.multiplier:=b_in
  stationaryOutput(c_in, c_out)
}

class PEArray(
  m:Int,n:Int, myarchw: List[Int], inedges: Map[List[Int], List[Int]], outedges: Map[List[Int], List[Int]], res: Map[Int, List[Int]],
          myarcha: List[Int], pedge: Map[List[Int], List[Int]], gedge: Map[List[Int], List[Int]], post: Map[Int, Int],
          myarcha2: List[Int], pedge2: Map[List[Int], List[Int]], gedge2: Map[List[Int], List[Int]], post2: Map[Int, Int],// from MAC
  pesize:Int, arraylength:Int, arraywidth:Int
) extends Module{
  val a_in = IO(Input(Vec(4, dtype)))
  val b_in = IO(Input(Vec(4, dtype)))
  val c_in = IO(Input(Vec(4, dtype)))
  val c_out = IO(Output(Vec(4, dtype)))
  val stationaryCtrl = IO(Input(Bool()))

  // TODO: finish this module
  def systolicInputConnect(
    PEs: Seq[Seq[PE[T]]],
    dx: Int,
    dy: Int,
    tensor: Int
  ): Unit = {
    for (i<-0 until arraypara.n; j<-0 until arraypara.n)
    if (0 <= i+dx && i+dx < arraypara.n && 0 <= j+dy && j+dy < arraypara.n){
    if(tensor==TensorType.a)
    PEs(i+dx)(j+dy).a_in := PEs(i)(j).a_out
    else  if(tensor==TensorType.b)
    PEs(i+arraypara.bdx)(j+arraypara.bdy).b_in := PEs(i)(j).b_out
    else  if(tensor==TensorType.c)
    PEs(i+dx)(j+dy).c_in := PEs(i)(j).c_out
    }
  }
  def stationaryInputConnect(
    PEs: Seq[Seq[PE[T]]],
    tensor: Int
  ): Unit = {
    for (i<-0 until arraypara.n; j<-0 until arraypara.n-1)
    if(tensor==TensorType.a)
    PEs(i)(j+1).a_in := PEs(i)(j).a_out
    else  if(tensor==TensorType.b)
    PEs(i)(j+1).b_in := PEs(i)(j).b_out
    else  if(tensor==TensorType.c)
    PEs(i)(j+1).c_in := PEs(i)(j).c_out
  }
  def stationaryInputConnect2(
    PEs: Seq[Seq[PE[T]]],
    tensor: Int
    ): Unit = {
    for (i<-0 until arraypara.n-1; j<-0 until arraypara.n)
    if(tensor==TensorType.a)
    PEs(i+1)(j).a_in := PEs(i)(j).a_out
    else  if(tensor==TensorType.b)
    PEs(i+1)(j).b_in := PEs(i)(j).b_out
    else  if(tensor==TensorType.c)
    PEs(i+1)(j).c_in := PEs(i)(j).c_out
  }
  def multicastInputConnect =systolicInputConnect _
  def systolicOutputConnect=systolicInputConnect _
  def stationaryOutputConnect =stationaryInputConnect _

  def adderTree(
    se:Vec[T]
  ):UInt={
    val n=se.length
    if(n==1) se(0)
    else{
      val m = if (n%2==0) n/2 else n/2+1
      val b = Reg(Vec(m,dtype))
      for (i<-0 until n/2) 
      b(i):=se(2*i)+se(2*i+1)
      if (n%2==1) b(m-1) := se(n-1)
      adderTree(b)
    }
  }
  def multicastOutputConnect (
    PEs: Seq[Seq[PE[T]]],
    dx: Int,
    dy: Int,
    tensor: Int
  ): Unit = {
    if(tensor==2){
      if (dx == 0 && dy == 1) {
      for (i<-0 until arraypara.n){
        val t=Wire(Vec(arraypara.n,dtype))
        for(j<-0 until arraypara.n)t(j):= PEs(i)(j).c_out
        for(j<-0 until arraypara.n)PEs(i)(j).c_in:=c_in(i)
      val sum=Reg(dtype)
      sum:=adderTree(t) // Sum of a column
      c_out(i):=sum
      }
      } else { 
        //用不到
       }  
    }
}



  val PEs = for (i<-0 until arraypara.n) yield
  for (j<-0 until arraypara.n) yield
  Module(new PE(dtype,arraypara.aType,arraypara.bType,arraypara.cType))

  for(i<-0 until arraypara.n){
    PEs(0)(i).a_in:=a_in(i)
    PEs(0)(i).b_in:=b_in(i)
  }

  for(i<-0 until arraypara.n;j<-0 until arraypara.n){
    PEs(i)(j).stationaryCtrl:=stationaryCtrl
  }

  if (arraypara.aType == ReuseType.Systolic)
  systolicInputConnect(PEs, arraypara.adx, arraypara.ady,0)
  else if (arraypara.aType == ReuseType.Multicast)
  multicastInputConnect(PEs, arraypara.adx, arraypara.ady,0)
  else  if (arraypara.aType == ReuseType.Stationary)
  stationaryInputConnect2(PEs,0)

  if (arraypara.bType == ReuseType.Systolic)
  systolicInputConnect(PEs, arraypara.bdx, arraypara.bdy,1)
  else if (arraypara.bType == ReuseType.Multicast)
  multicastInputConnect(PEs, arraypara.bdx, arraypara.bdy,1)
  else  if (arraypara.bType == ReuseType.Stationary)
  stationaryInputConnect(PEs,1)

  if (arraypara.cType == ReuseType.Systolic)
  systolicOutputConnect(PEs, arraypara.cdx, arraypara.cdy,2)
  else if (arraypara.cType == ReuseType.Multicast)
  multicastOutputConnect(PEs, arraypara.cdx, arraypara.cdy,2)
  else  if (arraypara.cType == ReuseType.Stationary)
  stationaryOutputConnect(PEs,2)

}

```



#### Error stacktrace:

```
java.lang.String.<init>(String.java:196)
	scala.tools.nsc.interactive.Global.typeCompletions$1(Global.scala:1231)
	scala.tools.nsc.interactive.Global.completionsAt(Global.scala:1254)
	scala.meta.internal.pc.SignatureHelpProvider.$anonfun$treeSymbol$1(SignatureHelpProvider.scala:390)
	scala.Option.map(Option.scala:230)
	scala.meta.internal.pc.SignatureHelpProvider.treeSymbol(SignatureHelpProvider.scala:388)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCall$.unapply(SignatureHelpProvider.scala:205)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.visit(SignatureHelpProvider.scala:316)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.traverse(SignatureHelpProvider.scala:310)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.traverse(SignatureHelpProvider.scala:275)
	scala.reflect.api.Trees$Traverser.$anonfun$traverseTrees$1(Trees.scala:2492)
	scala.reflect.api.Trees$Traverser.traverseTrees(Trees.scala:2492)
	scala.reflect.internal.Trees.traverseComponents$1(Trees.scala:1348)
	scala.reflect.internal.Trees.itraverse(Trees.scala:1394)
	scala.reflect.internal.Trees.itraverse$(Trees.scala:1264)
	scala.reflect.internal.SymbolTable.itraverse(SymbolTable.scala:28)
	scala.reflect.internal.SymbolTable.itraverse(SymbolTable.scala:28)
	scala.reflect.api.Trees$Traverser.traverse(Trees.scala:2483)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.visit(SignatureHelpProvider.scala:350)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.traverse(SignatureHelpProvider.scala:310)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.$anonfun$visit$5(SignatureHelpProvider.scala:346)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.$anonfun$visit$5$adapted(SignatureHelpProvider.scala:323)
	scala.collection.TraversableLike$WithFilter.$anonfun$foreach$1(TraversableLike.scala:985)
	scala.collection.immutable.List.foreach(List.scala:431)
	scala.collection.TraversableLike$WithFilter.foreach(TraversableLike.scala:984)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.$anonfun$visit$3(SignatureHelpProvider.scala:323)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.$anonfun$visit$3$adapted(SignatureHelpProvider.scala:322)
	scala.collection.TraversableLike$WithFilter.$anonfun$foreach$1(TraversableLike.scala:985)
	scala.collection.immutable.List.foreach(List.scala:431)
	scala.collection.TraversableLike$WithFilter.foreach(TraversableLike.scala:984)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.visit(SignatureHelpProvider.scala:322)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.traverse(SignatureHelpProvider.scala:310)
	scala.meta.internal.pc.SignatureHelpProvider$MethodCallTraverser.fromTree(SignatureHelpProvider.scala:279)
	scala.meta.internal.pc.SignatureHelpProvider.signatureHelp(SignatureHelpProvider.scala:27)
	scala.meta.internal.pc.ScalaPresentationCompiler.$anonfun$signatureHelp$1(ScalaPresentationCompiler.scala:310)
```
#### Short summary: 

java.lang.StringIndexOutOfBoundsException: String index out of range: -6